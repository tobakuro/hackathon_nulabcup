{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": [
    "nodejs@24",
    "go@1.26",
    "postgresql_18@18.2",
    "redis@8.2.3",
    "air@latest",
    "golangci-lint@latest",
    "sqlc@latest",
    "go-migrate@latest"
  ],
  "shell": {
    "init_hook": [
      "if [ ! -d \"$PGDATA\" ] || [ -z \"$(ls -A $PGDATA 2>/dev/null)\" ]; then echo 'Initializing PostgreSQL...'; initdb -D \"$PGDATA\"; fi",
      "if ! (pg_ctl status -D \"$PGDATA\" 2>/dev/null | grep -q 'server is running' && redis-cli ping 2>/dev/null | grep -q 'PONG'); then echo 'サービスを起動しています...'; devbox services up --background; fi"
    ],
    "scripts": {
      "db:setup": [
        "if ! psql -lqt 2>/dev/null | cut -d '|' -f 1 | grep -qw hackathon; then createdb hackathon && echo 'Created database: hackathon'; else echo 'Database hackathon already exists'; fi",
        "psql hackathon -f backend/db/migrations/001_init.sql && echo 'Migration applied.'"
      ],
      "backend:dev": [
        "cd backend && air"
      ],
      "backend:run": [
        "cd backend && go run ./cmd/server"
      ],
      "backend:build": [
        "cd backend && go build -o bin/server ./cmd/server"
      ],
      "frontend:dev": [
        "cd frontend && npm run dev"
      ],
      "frontend:install": [
        "cd frontend && npm install"
      ],
      "sqlc:generate": [
        "cd backend/db && sqlc generate"
      ]
    }
  }
}
